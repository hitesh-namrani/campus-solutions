<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Hub | Decentralized Campus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* THEME: Background #CBDCEB, Highlights #1B3C53 */
        body { 
            background: #CBDCEB;
            font-family: 'Inter', sans-serif; 
            color: #1f2937; 
            min-height: 100vh;
        }
        
        /* Glass Effect */
        .glass { 
            background: rgba(255, 255, 255, 0.4); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.75); 
            border: 1px solid rgba(255, 255, 255, 0.9);
        }

        .glass-card:hover { 
            background: rgba(255, 255, 255, 0.9); 
            transform: translateY(-2px); 
            transition: all 0.3s ease; 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        /* Sidebar Specific - Updated to #D2C1B6 (Taupe) */
        aside.glass {
            background: rgba(210, 193, 182, 0.75); /* #D2C1B6 with opacity */
            border-right: 1px solid rgba(255, 255, 255, 0.6);
        }

        /* Inputs for Light Mode */
        .admin-input { 
            width: 100%; 
            background: rgba(255, 255, 255, 0.7); 
            border: 1px solid rgba(27, 60, 83, 0.3); 
            padding: 0.75rem; 
            border-radius: 0.5rem; 
            font-size: 0.875rem; 
            transition: all 0.2s; 
            color: #1B3C53; 
        }
        .admin-input:focus { 
            outline: none; 
            border-color: #1B3C53; 
            background: rgba(255, 255, 255, 1); 
            box-shadow: 0 0 0 3px rgba(27, 60, 83, 0.2);
        }

        .hidden-card { display: none !important; }
        .clickable { cursor: pointer; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast { animation: slideIn 0.5s ease forwards; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- SIDEBAR (Updated Color) -->
    <aside class="w-64 glass flex flex-col hidden md:flex">
        <div class="p-6 flex items-center space-x-3">
            <!-- Logo Highlight -->
            <div class="w-8 h-8 bg-[#1B3C53] rounded-lg flex items-center justify-center shadow-lg shadow-slate-400">
                <span class="font-bold text-white">S</span>
            </div>
            <span class="text-xl font-bold tracking-wide text-[#1B3C53]">Student Hub</span>
        </div>
        <nav class="flex-1 px-4 space-y-2 mt-4">
            <a href="#" data-target="dashboard" onclick="renderView('dashboard')" class="nav-item flex items-center space-x-3 p-3 rounded-lg bg-[#1B3C53] text-white shadow-md transition">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i> <span>Dashboard</span>
            </a>
            <a href="#" data-target="events" onclick="renderView('events')" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-white/60 text-gray-700 transition">
                <i data-lucide="calendar" class="w-5 h-5"></i> <span>Events</span>
            </a>
            <a href="#" data-target="grievance" onclick="renderView('grievance')" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-white/60 text-gray-700 transition">
                <i data-lucide="users" class="w-5 h-5"></i> <span>Grievance</span>
            </a>
            
            <div class="border-t border-gray-600/20 my-2"></div>
            
            <button onclick="requestAdminAccess()" class="nav-item w-full flex items-center space-x-3 p-3 rounded-lg hover:bg-white/60 text-gray-700 transition mt-2">
                <i data-lucide="lock" class="w-5 h-5"></i> <span>Admin Access</span>
            </button>

            <a href="#" id="admin-nav-link" data-target="admin" onclick="renderView('admin')" class="nav-item flex items-center space-x-3 p-3 rounded-lg bg-red-100 text-red-500 hover:bg-red-200 transition mt-2 hidden-card border border-red-200">
                <i data-lucide="shield-alert" class="w-5 h-5"></i> <span>Admin Panel</span>
            </a>
        </nav>
        <div class="p-4 border-t border-gray-600/20">
            <div class="glass p-3 rounded-lg flex items-center space-x-3 bg-white/40">
                <div id="status-indicator" class="w-3 h-3 rounded-full bg-red-400 shadow-sm"></div>
                <div class="overflow-hidden">
                    <p class="text-xs text-gray-600">Status</p>
                    <p id="connection-status" class="text-sm font-semibold truncate text-gray-800">Disconnected</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto p-6 relative">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 id="page-title" class="text-3xl font-bold text-[#1B3C53]">Student Dashboard</h1>
                <p class="text-gray-600 text-sm">Manage your academic life on-chain.</p>
            </div>
            <!-- Connect Button Highlight -->
            <button id="connect-btn" class="glass px-6 py-2.5 rounded-full font-medium text-[#1B3C53] hover:bg-white transition flex items-center space-x-2 shadow-sm border border-white/60">
                <i data-lucide="wallet" class="w-4 h-4 text-[#1B3C53]"></i> <span>Connect Wallet</span>
            </button>
        </header>

        <div id="main-grid" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- FEED -->
            <div id="card-feed" onclick="renderView('feed')" class="glass p-6 rounded-2xl glass-card clickable">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold flex items-center text-gray-800"><i data-lucide="bell" class="w-5 h-5 mr-2 text-[#1B3C53]"></i> Feed</h2>
                    <span class="text-xs bg-red-100 text-red-500 px-2 py-1 rounded border border-red-200">Live</span>
                </div>
                <div id="feed-list" class="space-y-3 max-h-64 overflow-y-auto">
                    <p class="text-xs text-gray-600 italic">No updates yet.</p>
                </div>
            </div>

            <!-- GRIEVANCE -->
            <div id="card-dao" class="glass p-6 rounded-2xl glass-card lg:col-span-2">
                <h2 class="text-lg font-semibold mb-4 flex items-center text-gray-800"><i data-lucide="vote" class="w-5 h-5 mr-2 text-[#1B3C53]"></i> Grievance</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="text-xs text-gray-700 uppercase font-bold">New Proposal</label>
                        <textarea id="proposal-desc" class="admin-input mt-2" rows="3" placeholder="Describe grievance..."></textarea>
                        <!-- Submit Button Highlight -->
                        <button id="create-proposal-btn" class="mt-3 w-full py-2 bg-[#1B3C53] hover:bg-[#2a5573] text-white rounded-lg text-sm font-medium transition shadow-sm">Submit Proposal (Cost: Gas)</button>
                        <p class="text-[10px] text-gray-600 mt-1">*Requires Voting Power ($SHT)</p>
                    </div>
                    <div>
                        <label class="text-xs text-gray-700 uppercase font-bold">Active Vote</label>
                        <div id="active-proposal-container" class="p-4 bg-white/50 rounded-xl border border-white/60 mt-2">
                            <p class="text-sm text-gray-600">Loading proposals...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EVENTS -->
            <div id="card-events" class="glass p-6 rounded-2xl glass-card lg:col-span-2">
                <h2 class="text-lg font-semibold mb-4 flex items-center text-gray-800"><i data-lucide="calendar" class="w-5 h-5 mr-2 text-[#1B3C53]"></i> Upcoming Events</h2>
                <div id="events-list" class="grid md:grid-cols-2 gap-4"><p class="text-sm text-gray-600">No events found.</p></div>
            </div>

            <!-- NOTICES -->
            <div id="card-notices" onclick="renderView('notices')" class="glass p-6 rounded-2xl glass-card clickable">
                <h2 class="text-lg font-semibold mb-4 flex items-center text-gray-800"><i data-lucide="megaphone" class="w-5 h-5 mr-2 text-[#1B3C53]"></i> Notices</h2>
                <ul id="notices-list" class="space-y-3 max-h-64 overflow-y-auto">
                    <li class="text-sm text-gray-600 italic">No notices.</li>
                </ul>
            </div>

            <!-- ADMIN PANEL -->
            <div id="card-admin" class="glass p-8 rounded-2xl glass-card lg:col-span-3 hidden-card border-l-4 border-[#1B3C53]">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold flex items-center text-gray-800"><i data-lucide="shield-check" class="w-6 h-6 mr-3 text-[#1B3C53]"></i> Admin Control Center</h2>
                    <span class="text-xs bg-[#1B3C53]/20 text-[#1B3C53] px-3 py-1 rounded-full border border-[#1B3C53]/30">Authorized Access</span>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
                    <div class="space-y-6">
                        <div class="bg-white/50 p-5 rounded-xl border border-white/70">
                            <h3 class="font-semibold text-sm mb-4 flex items-center text-gray-800"><i data-lucide="rss" class="w-4 h-4 mr-2 text-yellow-600"></i> Post to Feed</h3>
                            <input type="text" id="admin-feed-msg" placeholder="Short update message..." class="admin-input mb-3">
                            <button onclick="adminAddFeed()" class="w-full bg-[#1B3C53] hover:bg-[#2a5573] text-white py-2 rounded-lg text-sm font-medium transition">Post Update</button>
                        </div>
                        <div class="bg-white/50 p-5 rounded-xl border border-white/70">
                            <h3 class="font-semibold text-sm mb-4 flex items-center text-gray-800"><i data-lucide="megaphone" class="w-4 h-4 mr-2 text-pink-600"></i> Official Notice</h3>
                            <input type="text" id="admin-notice-title" placeholder="Notice Title" class="admin-input mb-3">
                            <textarea id="admin-notice-desc" placeholder="Detailed description..." rows="2" class="admin-input mb-3"></textarea>
                            <button onclick="adminAddNotice()" class="w-full bg-pink-500 hover:bg-pink-600 text-white py-2 rounded-lg text-sm font-medium transition">Publish Notice</button>
                        </div>
                    </div>

                    <div class="bg-white/50 p-5 rounded-xl border border-white/70 h-full flex flex-col">
                        <h3 class="font-semibold text-sm mb-4 flex items-center text-gray-800"><i data-lucide="calendar-plus" class="w-4 h-4 mr-2 text-blue-600"></i> Create New Event</h3>
                        <div class="space-y-4 flex-grow">
                            <input type="text" id="admin-event-title" placeholder="Event Name" class="admin-input">
                            <input type="text" id="admin-event-link" placeholder="Registration Link" class="admin-input">
                            <div class="space-y-3">
                                <div><label class="text-xs text-gray-600 mb-1 block">Event Date</label><input type="date" id="admin-event-date" class="admin-input"></div>
                                <div><label class="text-xs text-gray-600 mb-1 block">Registration Deadline</label><input type="date" id="admin-event-deadline" class="admin-input"></div>
                            </div>
                        </div>
                        <button onclick="adminAddEvent()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2.5 rounded-lg text-sm font-medium transition mt-6">Create Event</button>
                    </div>

                    <div class="bg-white/50 p-5 rounded-xl border border-green-200 h-full relative overflow-hidden md:col-span-2 xl:col-span-1">
                        <h3 class="font-semibold text-sm mb-4 flex items-center text-gray-800"><i data-lucide="coins" class="w-4 h-4 mr-2 text-green-600"></i> Distribute Voting Power</h3>
                        <p class="text-xs text-gray-600 mb-4 leading-relaxed">Mint new <b>$SHT Tokens</b> directly to a student's wallet.</p>
                        <div class="space-y-4">
                            <div><label class="text-xs text-gray-600 mb-1 block">Wallet Address</label><input type="text" id="admin-mint-address" placeholder="0x..." class="admin-input border-green-200 focus:border-green-400"></div>
                            <div><label class="text-xs text-gray-600 mb-1 block">Amount</label><input type="number" id="admin-mint-amount" placeholder="e.g. 100" class="admin-input border-green-200 focus:border-green-400"></div>
                        </div>
                        <button onclick="adminMintTokens()" class="w-full bg-green-600 hover:bg-green-700 text-white py-2.5 rounded-lg text-sm font-medium transition mt-6">Send Tokens</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="toast-container" class="fixed bottom-5 right-5 z-50 space-y-3"></div>

    <script>
        const SERVER_URL = "http://localhost:3000";
        const SEPOLIA_CHAIN_ID = '0xaa36a7'; 
        let provider, signer, contracts = {}, currentAccount = "";
        const TOKEN_ABI = ["function balanceOf(address) view returns (uint256)"];

        document.addEventListener("DOMContentLoaded", () => {
            if (typeof lucide !== 'undefined') lucide.createIcons();
            document.getElementById('connect-btn').addEventListener('click', connectWallet);
            document.getElementById('create-proposal-btn').addEventListener('click', createProposal);
        });

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            let colors;
            if (type === 'error') colors = 'bg-red-100 text-red-600 border-red-200';
            else if (type === 'success') colors = 'bg-green-100 text-green-600 border-green-200';
            else colors = 'bg-white text-gray-700 border-gray-200';
            
            toast.className = `toast ${colors} text-sm px-4 py-3 rounded-lg shadow-xl border flex items-center space-x-2`;
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.remove(); }, 4000);
        }

        async function requestAdminAccess() {
            const password = prompt("Enter Admin Password:");
            if (!password) return;
            try {
                const res = await fetch(`${SERVER_URL}/api/verify-admin`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ password })
                });
                const data = await res.json();
                if (data.success) { 
                    document.getElementById('admin-nav-link').classList.remove('hidden-card');
                    renderView('admin');
                    showToast("Admin Access Granted", "success");
                } else { showToast("Incorrect Password", "error"); }
            } catch (e) { showToast("Server Verification Failed", "error"); }
        }

        window.renderView = function(viewName) {
            const cards = { feed: document.getElementById('card-feed'), dao: document.getElementById('card-dao'), events: document.getElementById('card-events'), notices: document.getElementById('card-notices'), admin: document.getElementById('card-admin') };
            const title = document.getElementById('page-title');
            Object.values(cards).forEach(c => c.classList.remove('lg:col-span-3', 'lg:col-span-2', 'hidden-card'));
            if (viewName === 'dashboard') { title.textContent = "Student Dashboard"; cards.admin.classList.add('hidden-card'); cards.dao.classList.add('lg:col-span-2'); cards.events.classList.add('lg:col-span-2'); }
            else if (viewName === 'admin') { title.textContent = "Admin Panel"; Object.values(cards).forEach(c => c !== cards.admin && c.classList.add('hidden-card')); cards.admin.classList.add('lg:col-span-3'); }
            else if (viewName === 'events') { title.textContent = "Upcoming Events"; Object.values(cards).forEach(c => c !== cards.events && c.classList.add('hidden-card')); cards.events.classList.add('lg:col-span-3'); }
            else if (viewName === 'feed') { title.textContent = "Student Feed"; Object.values(cards).forEach(c => c !== cards.feed && c.classList.add('hidden-card')); cards.feed.classList.add('lg:col-span-3'); }
            else if (viewName === 'notices') { title.textContent = "Notices"; Object.values(cards).forEach(c => c !== cards.notices && c.classList.add('hidden-card')); cards.notices.classList.add('lg:col-span-3'); }
            else if (viewName === 'grievance') { title.textContent = "Grievance Portal"; Object.values(cards).forEach(c => c !== cards.dao && c.classList.add('hidden-card')); cards.dao.classList.add('lg:col-span-3'); }
            
            const navLinks = document.querySelectorAll('.nav-item');
            navLinks.forEach(link => {
                const target = link.getAttribute('data-target');
                if (target === viewName) { link.classList.add('bg-[#1B3C53]', 'text-white', 'shadow-md'); link.classList.remove('hover:bg-white/60', 'text-gray-600', 'hover:bg-red-200', 'text-red-500', 'bg-red-100'); }
                else { 
                    link.classList.remove('bg-[#1B3C53]', 'text-white', 'shadow-md'); 
                    if (link.id === 'admin-nav-link') { link.classList.add('hover:bg-red-200', 'text-red-500', 'bg-red-100'); }
                    else if (link.tagName !== 'BUTTON') link.classList.add('hover:bg-white/60', 'text-gray-600'); 
                }
            });
        };

        async function connectWallet() {
            if (!window.ethereum) return alert("Install MetaMask");
            try {
                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                const chainId = await ethereum.request({ method: 'eth_chainId' });
                if (chainId !== SEPOLIA_CHAIN_ID) { try { await ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: SEPOLIA_CHAIN_ID }] }); } catch (switchError) { if (switchError.code === 4902) {} else throw switchError; } }
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                currentAccount = accounts[0];
                document.getElementById('connect-btn').innerHTML = `<span>${accounts[0].slice(0,6)}...</span>`;
                document.getElementById('connection-status').textContent = "Connected";
                document.getElementById('status-indicator').classList.remove("bg-red-400");
                document.getElementById('status-indicator').classList.add("bg-green-500");
                const res = await fetch(`${SERVER_URL}/api/contracts`);
                const data = await res.json();
                contracts.Events = new ethers.Contract(data.Events.address, data.Events.abi, signer);
                contracts.Governance = new ethers.Contract(data.Governance.address, data.Governance.abi, signer);
                if (data.Token && data.Token.address && data.Token.address !== "PASTE_YOUR_TOKEN_ADDRESS_HERE") { contracts.Token = new ethers.Contract(data.Token.address, data.Token.abi, signer); }
                fetchContent();
            } catch (e) { console.error(e); showToast("Connection Failed", "error"); }
        }

        async function fetchContent() {
            try {
                const events = await contracts.Events.getEvents();
                const eventsList = document.getElementById('events-list');
                if(events.length > 0) eventsList.innerHTML = '';
                events.forEach(evt => {
                    const date = new Date(evt.eventDate * 1000).toLocaleDateString();
                    const deadline = new Date(evt.deadline * 1000).toLocaleDateString();
                    eventsList.innerHTML += `<div class="bg-white/40 p-4 rounded-xl border border-white/60 flex flex-col justify-between shadow-sm hover:shadow-md transition"><div><h3 class="font-bold text-lg text-gray-800">${evt.title}</h3><p class="text-xs text-blue-600 mt-1 font-medium">Event: ${date}</p><p class="text-xs text-red-500 font-medium">Deadline: ${deadline}</p></div><a href="${evt.link}" target="_blank" class="mt-4 text-center bg-blue-400 hover:bg-blue-500 text-white py-2 rounded text-sm shadow-sm">Register ↗</a></div>`;
                });
            } catch(e) {}
            try {
                const feeds = await contracts.Events.getFeeds();
                const feedList = document.getElementById('feed-list');
                if(feeds.length > 0) feedList.innerHTML = '';
                feeds.slice().reverse().forEach(f => { feedList.innerHTML += `<div class="p-3 bg-white/60 rounded-lg border-l-4 border-[#1B3C53] shadow-sm"><p class="text-sm font-medium text-gray-800">${f.message}</p><p class="text-[10px] text-gray-500 mt-1">${new Date(f.timestamp*1000).toLocaleTimeString()}</p></div>`; });
            } catch(e) {}
            try {
                const notices = await contracts.Events.getNotices();
                const noticeList = document.getElementById('notices-list');
                if(notices.length > 0) noticeList.innerHTML = '';
                notices.slice().reverse().forEach(n => { noticeList.innerHTML += `<li class="text-sm pb-2 border-b border-gray-300/50"><span class="block text-gray-800 font-semibold">${n.title}</span><span class="text-xs text-gray-500">${n.description}</span></li>`; });
            } catch(e) {}
            try {
                const count = await contracts.Governance.proposalCount();
                const container = document.getElementById('active-proposal-container');
                if (count.toNumber() > 0) {
                    const p = await contracts.Governance.proposals(count); 
                    const votesFor = ethers.utils.formatUnits(p.votesFor, 18);
                    const votesAgainst = ethers.utils.formatUnits(p.votesAgainst, 18);
                    const filter = contracts.Governance.filters.VoteCast(p.id, currentAccount);
                    const logs = await contracts.Governance.queryFilter(filter);
                    const hasVoted = logs.length > 0;
                    let buttonsHtml = hasVoted ? `<button disabled class="w-full py-2 rounded bg-gray-200 text-gray-500 text-xs cursor-not-allowed font-bold border border-gray-300">Voted ✅</button>` : `<div class="grid grid-cols-2 gap-2 mt-2"><button onclick="vote(${p.id}, true)" class="py-1.5 rounded bg-green-100 hover:bg-green-200 text-green-700 border border-green-200 text-xs transition font-medium">Vote For</button><button onclick="vote(${p.id}, false)" class="py-1.5 rounded bg-red-100 hover:bg-red-200 text-red-700 border border-red-200 text-xs transition font-medium">Vote Against</button></div>`;
                    container.innerHTML = `<div><div class="flex justify-between items-start"><h3 class="font-bold text-sm text-gray-800">${p.description}</h3><span class="text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded border border-green-200 font-medium">Active</span></div><p class="text-[10px] text-gray-500 mt-2 font-medium">For: ${parseFloat(votesFor).toFixed(2)} | Against: ${parseFloat(votesAgainst).toFixed(2)}</p>${buttonsHtml}</div>`;
                } else { container.innerHTML = `<p class="text-xs text-gray-400 italic">No active proposals found.</p>`; }
            } catch(e) { console.error("Proposal Fetch Error", e); }
        }

        async function adminAddFeed() { try { await (await contracts.Events.addFeed(document.getElementById('admin-feed-msg').value)).wait(); showToast("Posted!", "success"); fetchContent(); } catch(e) { showToast("Failed", "error"); } }
        async function adminAddNotice() { try { await (await contracts.Events.addNotice(document.getElementById('admin-notice-title').value, document.getElementById('admin-notice-desc').value)).wait(); showToast("Posted!", "success"); fetchContent(); } catch(e) { showToast("Failed", "error"); } }
        async function adminAddEvent() { try { await (await contracts.Events.addEvent(document.getElementById('admin-event-title').value, document.getElementById('admin-event-link').value, document.getElementById('admin-event-date').valueAsNumber/1000, document.getElementById('admin-event-deadline').valueAsNumber/1000)).wait(); showToast("Created!", "success"); fetchContent(); } catch(e) { showToast("Failed", "error"); } }
        async function adminMintTokens() { if (!contracts.Token) return showToast("Token contract not found.", "error"); const address = document.getElementById('admin-mint-address').value; const amount = document.getElementById('admin-mint-amount').value; try { await (await contracts.Token.mint(address, amount)).wait(); showToast(`Sent ${amount} Tokens!`, "success"); } catch(e) { showToast("Mint Failed", "error"); } }
        async function createProposal() { try { const desc = document.getElementById('proposal-desc').value; if(!desc) return showToast("Enter description", "error"); await (await contracts.Governance.createProposal(desc, 3)).wait(); showToast("Proposal Created!", "success"); fetchContent(); } catch(e) { showToast("Failed. Do you have tokens?", "error"); } }
        async function vote(id, support) { try { await (await contracts.Governance.vote(id, support)).wait(); showToast("Voted!", "success"); fetchContent(); } catch(e) { if(e.data && e.data.message && e.data.message.includes("Already voted")) showToast("Already Voted!", "error"); else showToast("Vote Failed.", "error"); } }
    </script>
</body>
</html>